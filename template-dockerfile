FROM node:fermium-alpine
WORKDIR /tmp/app
# COPY . .
COPY ./package.json ./package.json
COPY ./tsconfig.build.json ./tsconfig.build.json
COPY ./tsconfig.base.json ./tsconfig.base.json
COPY ./tsconfig.json ./tsconfig.json
COPY ./.yarnrc.yml ./.yarnrc.yml
COPY ./.yarn/ ./.yarn/

COPY ./packages/shared/ ./packages/shared/
COPY ./packages/router/ ./packages/router/
COPY ./packages/fixtures/ ./packages/fixtures/
COPY ./packages/server/ ./packages/server/

RUN yarn install
RUN mkdir -p /opt/app && cp -a /tmp/app/node_modules /opt/app/

WORKDIR /opt/app
COPY . .
RUN cd ./packages/server && yarn build